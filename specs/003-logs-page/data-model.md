# Data Model: Logs Page

**Feature**: 003-logs-page  
**Date**: 2025-01-12

## Entities

### LogEntry

Represents a single log entry compatible with Serilog structured logging format and Microsoft.Extensions.Logging.

**Properties**:

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `Id` | `ObjectId` | Yes | Primary key (auto-generated by LiteDB) |
| `Timestamp` | `DateTimeOffset` | Yes | When the log entry was created |
| `Level` | `string` | Yes | Log level (Debug, Info, Warn, Error, Fatal) |
| `Message` | `string` | Yes | Rendered log message |
| `MessageTemplate` | `string?` | No | Message template (if available from structured logging) |
| `Properties` | `Dictionary<string, object>?` | No | Structured data properties (key-value pairs) |
| `Exception` | `string?` | No | Serialized exception details (if exception was logged) |
| `SourceContext` | `string?` | No | Source context (typically type/namespace name) |
| `IsManualEntry` | `bool` | Yes | `true` if manually created, `false` if automatically captured |

**Validation Rules**:
- `Timestamp` must not be in the future
- `Level` must be one of: "Debug", "Info", "Warn", "Error", "Fatal" (case-insensitive)
- `Message` must not be null or empty
- `IsManualEntry` defaults to `false` for automatically captured entries, `true` for manually created entries

**State Transitions**:
- **Created**: New log entry created (automatically or manually)
- **Updated**: Only manually created entries (`IsManualEntry = true`) can be updated
- **Deleted**: Any entry can be deleted

**Relationships**:
- None (standalone entity)

**Storage**:
- LiteDB collection: `"logentries"`
- Indexes:
  - `Timestamp` (descending) - for chronological ordering
  - `Level` - for filtering by log level
  - `Message` - for search functionality
  - `IsManualEntry` - for editability checks

## Data Flow

### Automatic Capture Flow
1. Application code calls `ILogger.Log()`
2. `LogServiceLoggerProvider` receives log event
3. `LogServiceLogger` extracts data and creates `LogEntry`
4. `LogService.Create()` persists to LiteDB
5. Entry stored with `IsManualEntry = false`

### Manual Creation Flow
1. User interacts with `Logs.razor` component
2. Component calls `ILogService.Create()` with user-provided data
3. `LogService.Create()` creates `LogEntry` with `IsManualEntry = true`
4. Entry persisted to LiteDB

### Update Flow (Manual Entries Only)
1. User selects manually created entry in `Logs.razor`
2. Component calls `ILogService.Update()` with modified data
3. `LogService.Update()` validates `IsManualEntry = true`
4. If valid, updates entry in LiteDB
5. If invalid (read-only entry), throws `InvalidOperationException`

### Delete Flow
1. User selects entry in `Logs.razor`
2. Component calls `ILogService.Delete()`
3. `LogService.Delete()` removes entry from LiteDB
4. No validation required (any entry can be deleted)

### Search Flow
1. User enters search criteria in `Logs.razor`
2. Component calls `ILogService.Search()` with search term
3. `LogService.Search()` queries LiteDB:
   - Searches `Message` field (case-insensitive contains)
   - Searches `Properties` values (case-insensitive contains)
4. Returns filtered `LogEntry` collection
5. Component applies pagination and displays results

## Constraints

- **Uniqueness**: `Id` is unique (primary key)
- **Immutability**: Automatically captured entries (`IsManualEntry = false`) cannot be updated
- **Deletion**: Any entry can be deleted (no cascade constraints)
- **Search**: Case-insensitive search across message and properties
- **Pagination**: Results must support pagination (configurable page size: 25, 50, 100)

## Performance Considerations

- Indexes on `Timestamp`, `Level`, `Message`, and `IsManualEntry` for query performance
- Pagination limits result set size (prevents loading all entries)
- Search uses indexed fields where possible
- LiteDB handles concurrent access (thread-safe operations)
